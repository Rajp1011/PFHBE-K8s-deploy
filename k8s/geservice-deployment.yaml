# -----------------------------------------------------------
# GE Service: Deployments Only (1-5)
# -----------------------------------------------------------

# -------- GEService 1 --------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ge-service-1
  labels:
    app: ge-service
    shard: "1"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ge-service
      shard: "1"
  template:
    metadata:
      labels:
        app: ge-service
        shard: "1"
    spec:
      imagePullSecrets:
      - name: ghcr-pull-secret
      initContainers:
      - name: wait-for-config
        image: busybox:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Waiting for /mnt/Internal to be ready..."
            while [ -z "$(ls -A /mnt 2>/dev/null)" ]; do
              sleep 2
            done
            echo "Config found. Starting service."
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /mnt
      containers:
      - name: ge-service-container
        image: ghcr.io/rajp1011/pfhbe/geservice:v1.0.1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "1024Mi"
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: ASPNETCORE_URLS
          value: "http://+:8080"
        - name: REDIS_HOST_OVERRIDE
          value: "redis.default.svc.cluster.local:6379"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 20
          timeoutSeconds: 15
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 10
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /app/Internal
          readOnly: true
      volumes:
      - name: ge-service-config-volume
        persistentVolumeClaim:
          claimName: ge-service-config-pvc
---
# -------- GEService 2 --------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ge-service-2
  labels:
    app: ge-service
    shard: "2"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ge-service
      shard: "2"
  template:
    metadata:
      labels:
        app: ge-service
        shard: "2"
    spec:
      imagePullSecrets:
      - name: ghcr-pull-secret
      initContainers:
      - name: wait-for-config
        image: busybox:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Waiting for /mnt/Internal to be ready..."
            while [ -z "$(ls -A /mnt 2>/dev/null)" ]; do
              sleep 2
            done
            echo "Config found. Starting service."
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /mnt
      containers:
      - name: ge-service-container
        image: ghcr.io/rajp1011/pfhbe/geservice:v1.0.1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "1024Mi"
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: ASPNETCORE_URLS
          value: "http://+:8080"
        - name: REDIS_HOST_OVERRIDE
          value: "redis.default.svc.cluster.local:6379"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 20
          timeoutSeconds: 15
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 10
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /app/Internal
          readOnly: true
      volumes:
      - name: ge-service-config-volume
        persistentVolumeClaim:
          claimName: ge-service-config-pvc
---
# -------- GEService 3 --------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ge-service-3
  labels:
    app: ge-service
    shard: "3"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ge-service
      shard: "3"
  template:
    metadata:
      labels:
        app: ge-service
        shard: "3"
    spec:
      imagePullSecrets:
      - name: ghcr-pull-secret
      initContainers:
      - name: wait-for-config
        image: busybox:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Waiting for /mnt/Internal to be ready..."
            while [ -z "$(ls -A /mnt 2>/dev/null)" ]; do
              sleep 2
            done
            echo "Config found. Starting service."
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /mnt
      containers:
      - name: ge-service-container
        image: ghcr.io/rajp1011/pfhbe/geservice:v1.0.1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "1024Mi"
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: ASPNETCORE_URLS
          value: "http://+:8080"
        - name: REDIS_HOST_OVERRIDE
          value: "redis.default.svc.cluster.local:6379"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 20
          timeoutSeconds: 15
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 10
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /app/Internal
          readOnly: true
      volumes:
      - name: ge-service-config-volume
        persistentVolumeClaim:
          claimName: ge-service-config-pvc
---
# -------- GEService 4 --------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ge-service-4
  labels:
    app: ge-service
    shard: "4"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ge-service
      shard: "4"
  template:
    metadata:
      labels:
        app: ge-service
        shard: "4"
    spec:
      imagePullSecrets:
      - name: ghcr-pull-secret
      initContainers:
      - name: wait-for-config
        image: busybox:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Waiting for /mnt/Internal to be ready..."
            while [ -z "$(ls -A /mnt 2>/dev/null)" ]; do
              sleep 2
            done
            echo "Config found. Starting service."
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /mnt
      containers:
      - name: ge-service-container
        image: ghcr.io/rajp1011/pfhbe/geservice:v1.0.1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "1024Mi"
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: ASPNETCORE_URLS
          value: "http://+:8080"
        - name: REDIS_HOST_OVERRIDE
          value: "redis.default.svc.cluster.local:6379"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 20
          timeoutSeconds: 15
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 10
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /app/Internal
          readOnly: true
      volumes:
      - name: ge-service-config-volume
        persistentVolumeClaim:
          claimName: ge-service-config-pvc
---
# -------- GEService 5 --------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ge-service-5
  labels:
    app: ge-service
    shard: "5"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ge-service
      shard: "5"
  template:
    metadata:
      labels:
        app: ge-service
        shard: "5"
    spec:
      imagePullSecrets:
      - name: ghcr-pull-secret
      initContainers:
      - name: wait-for-config
        image: busybox:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Waiting for /mnt/Internal to be ready..."
            while [ -z "$(ls -A /mnt 2>/dev/null)" ]; do
              sleep 2
            done
            echo "Config found. Starting service."
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /mnt
      containers:
      - name: ge-service-container
        image: ghcr.io/rajp1011/pfhbe/geservice:v1.0.1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "1024Mi"
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: "Development"
        - name: ASPNETCORE_URLS
          value: "http://+:8080"
        - name: REDIS_HOST_OVERRIDE
          value: "redis.default.svc.cluster.local:6379"
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 20
          timeoutSeconds: 15
          failureThreshold: 6
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 10
          failureThreshold: 10
        volumeMounts:
        - name: ge-service-config-volume
          mountPath: /app/Internal
          readOnly: true
      volumes:
      - name: ge-service-config-volume
        persistentVolumeClaim:
          claimName: ge-service-config-pvc